{"version":3,"names":["createFragment","viewId","UIManager","dispatchViewManagerCommand","Wrld3dView","Commands","create","toString","processCommand","command","args","Marker","MarkerView","MapComponent","props","forwardedRef","useRef","isMapReady","moveToRegion","location","animated","duration","zoomLevel","Platform","OS","current","animateToRegion","moveToBuilding","highlight","dimensions","setDimensions","useState","width","height","ref","useEffect","findNodeHandle","setTimeout","mapStyles","PixelRatio","getPixelSizeForLayoutSize","onlayout","event","nativeEvent","layout","getMapCenter","message","NativeModules","getCameraBounds","getBuildingInformation","animateToBuilding","longitude","latitude","setBuildingHighlight","addBuildingHighlight","publicRef","useImperativeHandle","bind","style","styles","hiddenOver","Date","toDateString","initialCenter","onMapReady","precache","precacheDistance","children","React","forwardRef","StyleSheet","overflow"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport {\n  findNodeHandle,\n  LayoutChangeEvent,\n  PixelRatio,\n  Platform,\n  StyleSheet,\n  UIManager,\n  View,\n} from 'react-native';\nimport { NativeModules } from 'react-native';\n\nimport { WrldMap3d, Marker as MarkerView, Wrld3dProps } from './MapViewManager';\nimport { Commands, MapViewNativeComponentType, Region } from './type';\n\nconst createFragment = (viewId: number) =>\n  UIManager.dispatchViewManagerCommand(\n    viewId,\n    // we are calling the 'create' command\n    // @ts-ignore\n    UIManager.Wrld3dView.Commands.create.toString(),\n    [viewId]\n  );\n\nconst processCommand = (viewId: number, command: string, args: any[]) =>\n  UIManager.dispatchViewManagerCommand(viewId, command, args);\n\nexport const Marker = MarkerView;\n\nexport type MapViewRefPropsType = MapViewNativeComponentType;\n\nconst MapComponent: React.ForwardRefRenderFunction<\n  MapViewNativeComponentType,\n  Wrld3dProps\n> = (props, forwardedRef) => {\n  const viewId = useRef<number>(0);\n  const isMapReady = useRef<boolean>();\n\n  const moveToRegion = ({\n    location,\n    animated = false,\n    duration = 5000,\n    zoomLevel = -1,\n  }: {\n    location: Region;\n    animated: boolean;\n    duration?: number;\n    zoomLevel?: number;\n  }) => {\n    if (Platform.OS === 'android') {\n      processCommand(viewId.current, Commands.animateToRegion, [\n        location,\n        animated,\n        duration,\n        zoomLevel,\n      ]);\n    }\n  };\n\n  const moveToBuilding = ({\n    location,\n    highlight = false,\n    zoomLevel = -1,\n    animated = false,\n    duration = 3000,\n  }: {\n    location: Region;\n    highlight?: boolean;\n    zoomLevel?: number;\n    animated?: boolean;\n    duration?: number;\n  }) => {\n    if (Platform.OS === 'android') {\n      processCommand(viewId.current, Commands.moveToBuilding, [\n        location,\n        highlight,\n        zoomLevel,\n        animated,\n        duration,\n      ]);\n    }\n  };\n\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  const ref = useRef<any>(null);\n\n  useEffect(() => {\n    if (Platform.OS === 'android') {\n      viewId.current = findNodeHandle(ref.current) as number;\n      setTimeout(() => {\n        createFragment(viewId.current as number);\n      }, 2000);\n    }\n  }, []);\n\n  const mapStyles = {\n    // converts dpi to px, provide desired height\n    height: PixelRatio.getPixelSizeForLayoutSize(dimensions.height),\n    // converts dpi to px, provide desired width\n    width: PixelRatio.getPixelSizeForLayoutSize(dimensions.width),\n  };\n\n  const onlayout = (event: LayoutChangeEvent) => {\n    const { width, height } = event.nativeEvent.layout;\n    setDimensions({ width: width, height: height });\n  };\n\n  const getMapCenter = async () => {\n    const message = await NativeModules['MapViewModule'].getCameraBounds(\n      viewId.current\n    );\n    return message;\n  };\n\n  const getBuildingInformation = async ({\n    location,\n    animateToBuilding = false,\n    duration = 2000,\n    zoomLevel = 18,\n  }: {\n    location: Region;\n    animateToBuilding?: boolean;\n    duration?: number;\n    zoomLevel?: number;\n  }) => {\n    const message = await NativeModules['MapViewModule'].getBuildingInformation(\n      viewId.current,\n      location.longitude,\n      location.latitude,\n      animateToBuilding,\n      duration,\n      zoomLevel\n    );\n    return message;\n  };\n\n  const setBuildingHighlight = async ({ location }: { location: Region }) => {\n    const message = await NativeModules['MapViewModule'].addBuildingHighlight(\n      viewId.current,\n      location.longitude,\n      location.latitude\n    );\n    return message;\n  };\n\n  //mapevents\n  const publicRef = {\n    moveToRegion,\n    moveToBuilding,\n    getMapCenter,\n    getBuildingInformation,\n    setBuildingHighlight,\n  };\n\n  useImperativeHandle(forwardedRef, () => publicRef);\n\n  return (\n    // <ProviderContext.Provider value={{ provider: 'wrld3dMap' }}>\n    <View\n      onLayout={onlayout.bind(null)}\n      style={[\n        props.style ? props.style : { width: '100%', height: '100%' },\n        styles.hiddenOver,\n      ]}\n    >\n      <WrldMap3d\n        {...props}\n        key={new Date().toDateString()}\n        style={mapStyles}\n        // @ts-ignore\n        ref={ref}\n        zoomLevel={props.zoomLevel ? props.zoomLevel : 12}\n        initialCenter={\n          props.initialCenter\n            ? props.initialCenter\n            : {\n                latitude: 24.8620502,\n                longitude: 67.0708794,\n              }\n        }\n        onMapReady={() => {\n          isMapReady.current = true;\n          if (props.onMapReady) {\n            props.onMapReady();\n          }\n        }}\n        precache={props.precache}\n        precacheDistance={props.precacheDistance}\n      >\n        {props.children}\n      </WrldMap3d>\n    </View>\n  );\n};\n\nexport const Wrld3dView = React.forwardRef(MapComponent);\n\nconst styles = StyleSheet.create({\n  hiddenOver: { overflow: 'hidden' },\n});\n"],"mappings":"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"}