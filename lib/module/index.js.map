{"version":3,"names":["React","useEffect","useImperativeHandle","useRef","useState","findNodeHandle","PixelRatio","Platform","StyleSheet","UIManager","View","NativeModules","WrldMap3d","Marker","MarkerView","Commands","createFragment","viewId","dispatchViewManagerCommand","Wrld3dView","create","toString","processCommand","command","args","MapComponent","props","forwardedRef","isMapReady","moveToRegion","location","animated","duration","zoomLevel","OS","current","animateToRegion","moveToBuilding","highlight","dimensions","setDimensions","width","height","ref","setTimeout","mapStyles","getPixelSizeForLayoutSize","onlayout","event","nativeEvent","layout","getMapCenter","message","getCameraBounds","getBuildingInformation","animateToBuilding","longitude","latitude","setBuildingHighlight","addBuildingHighlight","publicRef","bind","style","styles","hiddenOver","Date","toDateString","initialCenter","onMapReady","precache","precacheDistance","children","forwardRef","overflow"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport {\n  findNodeHandle,\n  LayoutChangeEvent,\n  PixelRatio,\n  Platform,\n  StyleSheet,\n  UIManager,\n  View,\n} from 'react-native';\nimport { NativeModules } from 'react-native';\n\nimport { WrldMap3d, Marker as MarkerView, Wrld3dProps } from './MapViewManager';\nimport { Commands, MapViewNativeComponentType, Region } from './type';\n\nconst createFragment = (viewId: number) =>\n  UIManager.dispatchViewManagerCommand(\n    viewId,\n    // we are calling the 'create' command\n    // @ts-ignore\n    UIManager.Wrld3dView.Commands.create.toString(),\n    [viewId]\n  );\n\nconst processCommand = (viewId: number, command: string, args: any[]) =>\n  UIManager.dispatchViewManagerCommand(viewId, command, args);\n\nexport const Marker = MarkerView;\n\nexport type MapViewRefPropsType = MapViewNativeComponentType;\n\nconst MapComponent: React.ForwardRefRenderFunction<\n  MapViewNativeComponentType,\n  Wrld3dProps\n> = (props, forwardedRef) => {\n  const viewId = useRef<number>(0);\n  const isMapReady = useRef<boolean>();\n\n  const moveToRegion = ({\n    location,\n    animated = false,\n    duration = 5000,\n    zoomLevel = -1,\n  }: {\n    location: Region;\n    animated: boolean;\n    duration?: number;\n    zoomLevel?: number;\n  }) => {\n    if (Platform.OS === 'android') {\n      processCommand(viewId.current, Commands.animateToRegion, [\n        location,\n        animated,\n        duration,\n        zoomLevel,\n      ]);\n    }\n  };\n\n  const moveToBuilding = ({\n    location,\n    highlight = false,\n    zoomLevel = -1,\n    animated = false,\n    duration = 3000,\n  }: {\n    location: Region;\n    highlight?: boolean;\n    zoomLevel?: number;\n    animated?: boolean;\n    duration?: number;\n  }) => {\n    if (Platform.OS === 'android') {\n      processCommand(viewId.current, Commands.moveToBuilding, [\n        location,\n        highlight,\n        zoomLevel,\n        animated,\n        duration,\n      ]);\n    }\n  };\n\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  const ref = useRef<any>(null);\n\n  useEffect(() => {\n    if (Platform.OS === 'android') {\n      viewId.current = findNodeHandle(ref.current) as number;\n      setTimeout(() => {\n        createFragment(viewId.current as number);\n      }, 2000);\n    }\n  }, []);\n\n  const mapStyles = {\n    // converts dpi to px, provide desired height\n    height: PixelRatio.getPixelSizeForLayoutSize(dimensions.height),\n    // converts dpi to px, provide desired width\n    width: PixelRatio.getPixelSizeForLayoutSize(dimensions.width),\n  };\n\n  const onlayout = (event: LayoutChangeEvent) => {\n    const { width, height } = event.nativeEvent.layout;\n    setDimensions({ width: width, height: height });\n  };\n\n  const getMapCenter = async () => {\n    const message = await NativeModules['MapViewModule'].getCameraBounds(\n      viewId.current\n    );\n    return message;\n  };\n\n  const getBuildingInformation = async ({\n    location,\n    animateToBuilding = false,\n    duration = 2000,\n    zoomLevel = 18,\n  }: {\n    location: Region;\n    animateToBuilding?: boolean;\n    duration?: number;\n    zoomLevel?: number;\n  }) => {\n    const message = await NativeModules['MapViewModule'].getBuildingInformation(\n      viewId.current,\n      location.longitude,\n      location.latitude,\n      animateToBuilding,\n      duration,\n      zoomLevel\n    );\n    return message;\n  };\n\n  const setBuildingHighlight = async ({ location }: { location: Region }) => {\n    const message = await NativeModules['MapViewModule'].addBuildingHighlight(\n      viewId.current,\n      location.longitude,\n      location.latitude\n    );\n    return message;\n  };\n\n  //mapevents\n  const publicRef = {\n    moveToRegion,\n    moveToBuilding,\n    getMapCenter,\n    getBuildingInformation,\n    setBuildingHighlight,\n  };\n\n  useImperativeHandle(forwardedRef, () => publicRef);\n\n  return (\n    // <ProviderContext.Provider value={{ provider: 'wrld3dMap' }}>\n    <View\n      onLayout={onlayout.bind(null)}\n      style={[\n        props.style ? props.style : { width: '100%', height: '100%' },\n        styles.hiddenOver,\n      ]}\n    >\n      <WrldMap3d\n        {...props}\n        key={new Date().toDateString()}\n        style={mapStyles}\n        // @ts-ignore\n        ref={ref}\n        zoomLevel={props.zoomLevel ? props.zoomLevel : 12}\n        initialCenter={\n          props.initialCenter\n            ? props.initialCenter\n            : {\n                latitude: 24.8620502,\n                longitude: 67.0708794,\n              }\n        }\n        onMapReady={() => {\n          isMapReady.current = true;\n          if (props.onMapReady) {\n            props.onMapReady();\n          }\n        }}\n        precache={props.precache}\n        precacheDistance={props.precacheDistance}\n      >\n        {props.children}\n      </WrldMap3d>\n    </View>\n  );\n};\n\nexport const Wrld3dView = React.forwardRef(MapComponent);\n\nconst styles = StyleSheet.create({\n  hiddenOver: { overflow: 'hidden' },\n});\n"],"mappings":"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"}