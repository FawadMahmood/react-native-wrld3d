{"version":3,"names":["React","useEffect","useImperativeHandle","useRef","useState","findNodeHandle","PixelRatio","Platform","UIManager","View","NativeModules","WrldMap3d","Marker","MarkerView","Commands","createFragment","viewId","dispatchViewManagerCommand","Wrld3dView","create","toString","processCommand","command","args","MapComponent","props","forwardedRef","isMapReady","moveToRegion","location","animated","duration","zoomLevel","OS","current","animateToRegion","moveToBuilding","highlight","dimensions","setDimensions","width","height","ref","mapStyles","getPixelSizeForLayoutSize","onlayout","event","nativeEvent","layout","getMapCenter","message","getCameraBounds","getBuildingInformation","animateToBuilding","longitude","latitude","setBuildingHighlight","addBuildingHighlight","publicRef","bind","style","overflow","Date","toDateString","initialCenter","onMapReady","precache","precacheDistance","children","forwardRef"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport {\n  findNodeHandle,\n  LayoutChangeEvent,\n  PixelRatio,\n  Platform,\n  UIManager,\n  View,\n} from 'react-native';\nimport { NativeModules } from 'react-native';\n\n\nimport { WrldMap3d, Marker as MarkerView, Wrld3dProps } from './MapViewManager';\nimport { Commands, MapViewNativeComponentType, Region } from './type';\n\n\n\nconst createFragment = (viewId: number) =>\n  UIManager.dispatchViewManagerCommand(\n    viewId,\n    // we are calling the 'create' command\n    // @ts-ignore\n    UIManager.Wrld3dView.Commands.create.toString(),\n    [viewId]\n  );\n\nconst processCommand = (viewId: number, command: string, args: any[]) => UIManager.dispatchViewManagerCommand(\n  viewId,\n  command,\n  args\n);\n\nexport const Marker = MarkerView;\n\nexport type MapViewRefPropsType = MapViewNativeComponentType;\n\nconst MapComponent: React.ForwardRefRenderFunction<MapViewNativeComponentType, Wrld3dProps> = (\n  props,\n  forwardedRef,\n) => {\n\n  const viewId = useRef<number>(0)\n  const isMapReady = useRef<boolean>();\n\n\n  const moveToRegion = ({ location, animated = false, duration = 5000, zoomLevel = -1 }: { location: Region, animated: boolean, duration?: number, zoomLevel?: number }) => {\n    if (Platform.OS === \"android\") {\n      processCommand(viewId.current, Commands.animateToRegion, [location, animated, duration, zoomLevel]);\n    }\n  }\n\n  const moveToBuilding = ({ location, highlight = false, zoomLevel = -1, animated = false, duration = 3000 }: { location: Region, highlight?: boolean, zoomLevel?: number, animated?: boolean, duration?: number }) => {\n    if (Platform.OS === \"android\") {\n      processCommand(viewId.current, Commands.moveToBuilding, [location, highlight, zoomLevel, animated, duration]);\n    }\n  }\n\n\n\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  const ref = useRef<any>(null);\n\n  useEffect(() => {\n    if (Platform.OS === \"android\") {\n      viewId.current = findNodeHandle(ref.current) as number;\n      createFragment(viewId.current as number);\n    }\n  }, []);\n\n  const mapStyles = {\n    // converts dpi to px, provide desired height\n    height: PixelRatio.getPixelSizeForLayoutSize(dimensions.height),\n    // converts dpi to px, provide desired width\n    width: PixelRatio.getPixelSizeForLayoutSize(dimensions.width),\n  };\n\n\n  const onlayout = (event: LayoutChangeEvent) => {\n    const { width, height } = event.nativeEvent.layout;\n    setDimensions({ width: width, height: height });\n  }\n\n\n  const getMapCenter = async () => {\n    const message = await NativeModules['MapViewModule'].getCameraBounds(viewId.current);\n    return message;\n  }\n\n  const getBuildingInformation = async ({ location, animateToBuilding = false, duration = 2000, zoomLevel = 18 }: { location: Region, animateToBuilding?: boolean, duration?: number, zoomLevel?: number }) => {\n    const message = await NativeModules['MapViewModule'].getBuildingInformation(viewId.current, location.longitude, location.latitude, animateToBuilding, duration, zoomLevel);\n    return message;\n  }\n\n  const setBuildingHighlight = async ({ location }: { location: Region }) => {\n    const message = await NativeModules['MapViewModule'].addBuildingHighlight(viewId.current, location.longitude, location.latitude);\n    return message;\n  }\n\n  //mapevents\n  const publicRef = {\n    moveToRegion,\n    moveToBuilding,\n    getMapCenter,\n    getBuildingInformation,\n    setBuildingHighlight\n  };\n\n\n  useImperativeHandle(forwardedRef, () => publicRef);\n\n  return (\n    // <ProviderContext.Provider value={{ provider: 'wrld3dMap' }}>\n    <View onLayout={onlayout.bind(null)} style={[props.style ? props.style : { width: \"100%\", height: \"100%\" }, { overflow: \"hidden\" }]}>\n      <WrldMap3d\n        {...props}\n        key={new Date().toDateString()}\n        style={mapStyles}\n        // @ts-ignore\n        ref={ref}\n        zoomLevel={props.zoomLevel ? props.zoomLevel : 12}\n        initialCenter={props.initialCenter ? props.initialCenter : {\n          latitude: 24.8620502,\n          longitude: 67.0708794\n        }}\n        onMapReady={() => {\n          isMapReady.current = true;\n          if (props.onMapReady) {\n            props.onMapReady();\n          }\n        }}\n\n        precache={props.precache}\n        precacheDistance={props.precacheDistance}\n      >\n        {props.children}\n      </WrldMap3d>\n    </View>\n  )\n}\n\n\nexport const Wrld3dView = React.forwardRef(MapComponent);"],"mappings":"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"}